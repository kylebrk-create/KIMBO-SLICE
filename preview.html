<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width" />
<title>Elenack Motorplex — Template Preview</title>
<meta name="color-scheme" content="light">
<style>
  :root{
    --bg:#f6f8fb; --panel:#ffffff; --paper:#ffffff; --ink:#0f1720; --muted:#566073; --line:#e3e8ef;
    --brand:#C4162A; --accent:#1a66ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;padding:0}
  body{background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif}
  a{color:var(--accent);text-decoration:none}
  .bar{position:sticky;top:0;z-index:10;display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 16px;background:rgba(255,255,255,.9);border-bottom:1px solid var(--line);backdrop-filter:blur(8px)}
  .wrap{
    display:grid;
    grid-template-columns:1fr 380px;
    height:calc(100vh - 52px);
  }
  .stage{
    background:var(--bg);
    overflow:auto;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:24px;
  }
  .frame{
    width:100%;
    max-width:820px;
    height:calc(100vh - 96px);
    border:1px solid var(--line);
    border-radius:12px;
    overflow:hidden;
    background:#fff;
    box-shadow:0 1px 0 rgba(16,24,40,.02);
  }
  .frame iframe{
    display:block;
    width:100%;
    height:100%;
    border:0;
    overflow:auto;
    scroll-behavior:smooth;
    background:#fff;
  }
  .err{margin:0 0 16px;padding:12px;border:1px solid var(--line);background:#fff7f7;color:#7a0011;border-radius:8px;max-width:820px}
  .specs{
    border-left:1px solid var(--line);
    background:var(--panel);
    color:var(--ink);
    padding:24px 20px;
    overflow:auto;
  }
  .specs h2{margin:0 0 12px;font-size:18px;color:#0b1320}
  .specs h3{margin:18px 0 6px;font-size:14px;color:#1d2840}
  .specs p,.specs li{font-size:14px;line-height:1.55;color:var(--muted)}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2f7;border:1px solid #e3e8ef;font-size:12px;color:#394254}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .ok{color:#15803d}
  @media (max-width:1024px){
    .wrap{grid-template-columns:1fr}
    .specs{border-left:none;border-top:1px solid var(--line);height:auto;max-height:40vh}
  }
</style>
</head>
<body>
  <div class="bar">
    <a href="./">← Back to Gallery</a>
    <div style="opacity:.75;font-size:13px">Live preview • Status & tips</div>
  </div>

  <div class="wrap">
    <section class="stage">
      <div id="err" class="err" hidden></div>
      <div class="frame"><iframe id="frame" title="Email preview"></iframe></div>
    </section>

    <aside class="specs" aria-labelledby="title">
      <h2 id="title">Template Preview</h2>

      <h3>Resolved Source</h3>
      <p>File: <a id="open-src" href="#" target="_blank" rel="noopener" class="mono">—</a></p>
      <p>Status: <span id="status" class="pill">checking…</span></p>

      <h3>Image Specs</h3>
      <ul id="img-list">
        <li><strong>Hero:</strong> 600×(auto) px • <span class="pill">&lt; 200 KB</span> • JPG 80–85%</li>
      </ul>

      <h3>Best Practices</h3>
      <ul>
        <li><span class="ok">✓</span> 600px layout, live text, descriptive ALT</li>
        <li><span class="ok">✓</span> VML buttons for Outlook, 44px min height</li>
        <li><span class="ok">✓</span> Preheader 85–130 chars, CAN-SPAM footer</li>
        <li><span class="ok">✓</span> Avoid WebP; use JPG/PNG for email</li>
      </ul>

      <h3>Repeatable Process</h3>
      <ol>
        <li>Duplicate a template under <code class="mono">/templates</code>.</li>
        <li>Swap hero/copy/CTAs. Keep text live.</li>
        <li>Set preheader, verify address & unsubscribe.</li>
        <li>Test in Gmail + Outlook before send.</li>
      </ol>
    </aside>
  </div>

<script>
(async function(){
  // Read & normalize params
  const qs = new URLSearchParams(location.search);
  let tpl = qs.get('tpl') || qs.get('template') || '';
  const id  = qs.get('id') || '';

  if (tpl.startsWith('/')) tpl = tpl.replace(/^\/+/, '');
  if (!tpl.startsWith('./') && !tpl.startsWith('../')) tpl = './' + tpl;

  const iframe   = document.getElementById('frame');
  const openSrc  = document.getElementById('open-src');
  const statusEl = document.getElementById('status');
  const errBox   = document.getElementById('err');
  const titleEl  = document.getElementById('title');
  const setError = (html) => { errBox.hidden = false; errBox.innerHTML = html; };

  const TITLES = {
    accord: "Accord Hybrid — Offers",
    service: "Service & Tires",
    cpo: "Certified Pre-Owned",
    new: "New Vehicles"
  };
  titleEl.textContent = TITLES[id] || "Template Preview";

  if (tpl) { openSrc.href = tpl; openSrc.textContent = tpl; }
  else { statusEl.textContent = 'no file'; setError('No template specified. Use <code class="mono">?tpl=templates/your-file.html</code>.'); return; }

  try {
    const resp = await fetch(tpl, { cache: 'no-store' });
    statusEl.textContent = 'HTTP ' + resp.status;

    if (!resp.ok) {
      setError(`Could not load <code class="mono">${tpl}</code> (HTTP ${resp.status}).<br>
        Check file name and avoid leading slashes.`);
      return;
    }

    const html = await resp.text();
    const absFile  = new URL(tpl, location.href);
    const baseHref = new URL('.', absFile).href;
    const doc = `<!doctype html><html><head><base href="${baseHref}"></head><body>${html}</body></html>`;
    iframe.srcdoc = doc;
  } catch (e) {
    statusEl.textContent = 'network error';
    setError('Network error loading <code class="mono">' + tpl + '</code><br>' + String(e));
  }
})();
</script>
</body>
</html>
